---
title: Server-side tools (OpenAI Chat Completions API)
meta:
  title: Server-side tools (OpenAI Chat Completions API) | Tiptap Content AI
  description: Learn how to call tools in the server using the OpenAI Chat Completions API.
  category: Content AI
---

This guide explains how to call tools in the server using the OpenAI Chat Completions API. It presents an example of a tool that returns the weather in a given location.

First, define the tool in the [OpenAI Chat Completions API tool format](https://platform.openai.com/docs/guides/function-calling):

```ts
const weatherTool = {
  type: 'function',
  function: {
    name: 'get_weather',
    description: 'Returns the weather in a given location',
    parameters: {
      type: 'object',
      properties: {
        location: {
          type: 'string',
          description: 'The location to get the weather for',
        },
      },
      required: ['location'],
    },
  },
}
```

Then, when you call the OpenAI API, include the tool in the `tools` array.

```ts
import {
  AiAgentToolkit,
  openaiChatCompletionsAdapter,
  ChatMessagesFormatter,
} from '@tiptap-pro/extension-ai-agent-server'
import OpenAI from 'openai'

const toolkit = new AiAgentToolkit({
  adapter: openaiChatCompletionsAdapter,
})

const formatter = new ChatMessagesFormatter({
  initialMessages: chatMessages,
  adapter: openaiChatCompletionsAdapter,
})

// Initialize the OpenAI client
const openai = new OpenAI()

// Call the OpenAI Chat Completions API
const response = await openai.chat.completions.create({
  model: 'gpt-4.1',
  messages: [
    {
      role: 'system',
      content: `
<Your system prompt>
${toolkit.getSystemPrompt()}
`,
    },
    ...formatter.format(),
  ],
  // Include the weather tool in the tools array, beside
  // the other tools provided by AiAgentToolkit
  tools: [...toolkit.format(), weatherTool],
})
```

First, add the response to the formatter so that it is included in the conversation.

```ts
formatter.addAiResponse(response)
```

Then, check if the response contains a server-side tool call like the weather tool. If so, call the tool and add the result to the formatter. Then, call the OpenAI API again.

Repeat this process until there are no more server-side tool calls in the response.

```ts
for (const choice of response.choices) {
  if (!choice.message.tool_calls) {
    continue
  }

  for (const toolCall of choice.message.tool_calls) {
    const name = toolCall.function.name

    if (name !== 'get_weather') {
      continue
    }

    // Get weather from an external API
    const args = JSON.parse(toolCall.function.arguments)
    const result = getWeather(args)

    formatter.addChatMessage({
      type: 'toolCallResult',
      toolName: 'get_weather',
      toolCallId: toolCall.id,
      result: result.toString(),
    })
  }
}

// Call the OpenAI Chat Completions API again
const response = await openai.chat.completions.create({
  model: 'gpt-4.1',
  messages: [
    {
      role: 'system',
      content: `
<Your system prompt>
${toolkit.getSystemPrompt()}
`,
    },
    ...formatter.format(),
  ],
  // Include the weather tool in the tools array, beside
  // the other tools provided by AiAgentToolkit
  tools: [...toolkit.format(), weatherTool],
})
```

Finally, when there are no more server-side tool calls, use the `formatter` to convert the response to the format expected by the AI Agent extension.

```ts
const response = formatter.getResolverResponse()
```

The `response` should be the response of the API endpoint, and the return value of the `resolver` function.
